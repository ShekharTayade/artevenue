{% extends 'artevenue/estore_base.html' %}
{% load static %}
	<!-- Only Override the site content block -->
	{% block sitecontent %}
        <div class="container">
			<div class="row">

				<!-- breadcrumb-->
				<div class="col-lg-12">
					<nav aria-label="breadcrumb">
						<ol class="breadcrumb">
							<li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
							<li class="breadcrumb-item"><a href= "{% url 'show_all_categories' %}">Categories</a></li>
							<li aria-current="page" class="breadcrumb-item active">{{product_category.name}}</li>
						</ol>
					</nav>
				</div>

				<div class="col-lg-3">

					<button type="button" data-toggle="collapse" data-target="#cat_navigation" class="btn btn-outline-secondary navbar-toggler full-width-btn" style="width:100% !important;">
						<span class="sr-only">Toggle navigation</span>
						<i class="fa fa-align-justify"></i>Categories
					</button>

				
					 <!--
					 *** CATEGORIES AND FILTERS ***
					_________________________________________________________
					-->
					<div id = "cat_navigation" class="collapse show navbar-collapse">
						<div class="card sidebar-menu mb-4">
							<!--<div class="card-header">
								<h3 class="h4 card-title">Categories</h3>
							</div>-->
							<div class="card-body">
								<ul class="nav navbar-collapse nav-pills flex-column category-menu pull-left">
									<li><span class="badge badge-secondary">{{prod_cat_count}}</span>
									{% for p in prod_categories %}
										<ul class="list-unstyled">
											<li><a href="{% url 'category_stock_images' p.category_id %}" class="nav-link">{{p.name|title}}</a></li>
										</ul>
									{% endfor prod_categories %}
										<a href="{% url 'show_all_categories' %}"><small>See All...</small></a>
									</li>
								</ul>
							</div>
						</div>
					</div>
					<!-- Display the filters -->
					<button type="button" data-toggle="collapse" data-target="#filter_navigation" class="btn btn-outline-secondary navbar-toggler full-width-btn" style="width:100% !important;">
						<span class="sr-only">Toggle navigation</span>
						<i class="fa fa-align-justify"></i>Filter
					</button>
					<div id = "filter_navigation" class="collapse show navbar-collapse">
						<div class="card sidebar-menu mb-4">
							<!--<div class="card-header">
								<h3 class="h4 card-title">Filter</h3>
							</div>-->
							{% for pf in prod_filters %}
							<div class="card-body" style = "max-height:200px; width:auto; overflow:auto; margin-bottom:30px;">
								<h3 class="card-title">{{ pf|title }}</h3>
								<form id= "f_{{pf}}" role="form">
									<div class="form-group" style="margin-bottom:0.25em !important;">
										<div class="checkbox filter-class">
											{% for key, value in prod_filter_values.items %}
											
												{% if key == pf %}
													{% if pf == 'COLORS' %}
														<div id = "colors-div" class = "row" style = "padding:10px;">
														{% for val in value %}
															<div class = "col-sm-1 text-center" 
																style = "background-color:{{val}}; 
																	{% if val == 'White' %} border:1px solid gainsboro{% endif %}; 
																	border-radius:50%; width:20px; height:30px; 
																	margin:3px 3px;
																	color:{% if val == 'White' or val == 'Yellow'%} black {% else %} white {% endif %};"
																onclick = "select_color(this);"
																>
															</div>
														{% endfor %}
														</div>
													{% else %}

														{% for val in value %}												
														<input class = "{{pf}}" type="checkbox" />
															{% if pf == 'IMAGE-TYPE' %}
																<label style="display:none">{{val}}</label>{% if val == '1' %} Fine Art {% elif val == '0' %} Photo {% endif %}<br />
															{% else %}
																<label {% if pf == 'COLORS' %} style = "background-color:{{val}}; border:1px solid gainsboro; border-radius:50%; width:25px; height:25px" {% endif %}>{% if pf == 'COLORS' %} &nbsp; {% else %} {{val}}{% endif %}</label><br />
															{% endif %}
														{% endfor %}
													{% endif %}
												{% endif %}
											{% endfor prod_filter_values %}
										</div>
									</div>
									<button type = "button" class="btn btn-secondary btn-sm pull-left" onclick = "getAllFilters()"><i class="fa fa-pencil"></i> Apply</button>
									<button type = "button" class="btn btn-sm btn-outline-secondary pull-right" onclick = "clearFilter('{{pf}}')"><i class="fa fa-times-circle"></i> Clear</button>
								</form>
							</div>
							{% endfor prod_filters %}
							<div class="card-body" style = "max-height:200px; width:auto; overflow:auto; margin-bottom:30px;">
								<h3 class="card-title">Size</h3>
								<form id= "f_size" role="form">
									<div class="form-group" style="margin-bottom:0.25em !important;">
										<div class="checkbox filter-class">
											<select id ="size_select" class = "form-control" name = "size" />
												<option selected value = "any">Any</option>
												<option disabled value= "-">PORTRAIT:</option>
												<option value= "8_12"> 8" X 12"</option>
												<option value= "9_11"> 9" X 11" </option>
												<option value= "12_16"> 12" X 16" </option>
												<option value = "16_20"> 16" X 20"</option>
												<option value = "18_24"> 18" X 24"</option>
												<option value = "20_24"> 20" X 24"</option>
												<option value = "20_30"> 20" X 30"</option>
												<option value = "24_30"> 24" X 30"</option>
												<option value = "24_36"> 24" X 36"</option>
												<option value = "30_36"> 30" X 36"</option>
												<option value = "30_40"> 30" X 40"</option>
												<option value = "36_48"> 36" X 48"</option>
												<option value = "40_60"> 40" X 60"</option>
												<option value = "48_60"> 48" X 60"</option>
												<option value = "48_72"> 48" X 72"</option>
												<option disabled value = "24__">------------</option>
												<option disabled value= "-">LANDSCAPE:</option>
												<option value= "12_8"> 12" X 8"</option>
												<option value= "11_9"> 11" X 9" </option>
												<option value= "16_12"> 16" X 12" </option>
												<option value = "20_16"> 20" X 16"</option>
												<option value = "24_18"> 24" X 18"</option>
												<option value = "24_20"> 24" X 20"</option>
												<option value = "30_20"> 30" X 20"</option>
												<option value = "30_24"> 30" X 24"</option>
												<option value = "36_24"> 36" X 24"</option>
												<option value = "36_30"> 36" X 30"</option>
												<option value = "40_30"> 40" X 30"</option>
												<option value = "48_36"> 48" X 36"</option>
												<option value = "60_40"> 60" X 40"</option>
												<option value = "60_48"> 60" X 48"</option>
												<option value = "72_48"> 72" X 48"</option>
												<option disabled value = "24__">------------</option>
												<option disabled value= "-">SQAURE:</option>
												<option value= "12_12"> 12" X 12"</option>
												<option value= "18_18"> 18" X 18" </option>
												<option value = "24_24"> 24" X 24"</option>
												<option value = "30_30"> 30" X 30"</option>
												<option value = "36_36"> 36" X 36"</option>
												<option value = "40_40"> 40" X 40"</option>
												<option value = "48_48"> 48" X 48"</option>
												<option value = "54_54"> 54" X 54"</option>
												<option value = "60_60"> 60" X 60"</option>
											</select>	
										</div>
									</div>
									<button type = "button" class="btn btn-secondary btn-sm pull-left" onclick = "getAllFilters()"><i class="fa fa-pencil"></i> Apply</button>
									<button type = "button" class="btn btn-sm btn-outline-secondary pull-right" onclick = "clearFilter('{{pf}}')"><i class="fa fa-times-circle"></i> Clear</button>
								</form>
							</div>									
						</div>
					</div>
					<!-- *** CATEGORIES AND FILTERS END ***-->
				</div>
				<!-- /.col-md-3-->
	


				<div class="col-lg-9">
					<div class="box-cat">
						<h1>{% if product_category %} {{ product_category.name }} {% else %} All Art {% endif %}</h1>
						<p>{% if product_category.description %} {{product_category.description}} {% else %} Please use filters on left to narrow your search{% endif %}</p>
					 </div>
					 
					<!-- Category header -->
					<div class="box-cat info-bar">
						<div class="row">

							<div class="col-md-12 col-lg-12 products-number-sort">
								<form class="form-inline d-block d-lg-flex justify-content-between flex-column flex-md-row">
									<div class="products-number">
										<strong>Show</strong><a href="?page={{prods.number}}&sort={{sortOrder}}&show=50" class="btn btn-sm {% if show == '50' or show == None %} btn-primary {% else %} btn-outline-secondary {% endif %}">50</a><a href="?page={{prods.number}}&sort={{sortOrder}}&show=100" class="btn btn-sm {% if show == '100' %} btn-primary {% else %} btn-outline-secondary {% endif %}">100</a><a href="?page={{prods.number}}&sort={{sortOrder}}&show=ALL" class="btn btn-sm {% if show == 'ALL' %} btn-primary {% else %} btn-outline-secondary {% endif %}">All</a><span>results/page</span>
									</div>

								</form>
							</div>

						</div>
					</div>

					<div id = "img-display">
						{% include 'artevenue/prod_display_include.html' %}
					</div> <!-- END:  img-display -->
				</div>
				<!-- /.col-lg-9-->
				{% include 'artevenue/cart-add-message.html' %}
				
			</div>
		</div>
	{% endblock sitecontent %}

	
	{% block jscripts %}

	<script>
		// Clear the filers
		function clearFilter(ele_chx){
			$("." + ele_chx ).each(function(){ 
				$(this).prop('checked', false);
			});
		}
		
		function getAllFilters(){   
			var filter = '{';
			var fcnt = 0;
			{% for pf in prod_filters %}
				{% if pf != "COLORS" %}
					if (fcnt == 0) {
						filter = filter + '"{{pf}}": { ';
					} else {
						filter = filter + ', "{{pf}}": { ';
					}
					valcnt = 0;
					rec = ''
					$(".{{pf}}").each(function () {
						var val = $(this).next('label').text();
						var sts = $(this).is(":checked");
						if (sts) {
							if (valcnt == 0){
								rec = rec + '"' + val.trim() + '": ' + ' " ' + sts + '"';
							} else {
								rec = rec + ', "' + val.trim() + '": ' + ' " ' + sts + '"';
							}
							valcnt = valcnt + 1;
						}
						
					});
				filter = filter + rec + ' }';
				fcnt = fcnt + 1;
				{% endif %}
			{% endfor prod_filters %}
			
			var size_val = $("#size_select").val();

			if (size_val != "any") {
				rec = ', "SIZE": {"' + size_val + '" : ' + ' "true"';
				filter = filter + rec + ' }';
			}
			
			var chl = document.getElementById("colors-div").childNodes;
			var len = chl.length;
			var rec = ', "COLORS": {' ;
			valcnt = 0;
			for (i=0; i < len; i++){
				ele = chl[i];
				if (ele.innerHTML == "<i class=\"fa fa-check\"></i>") {
					if (valcnt == 0) {
						rec = rec + '"' + ele.style.backgroundColor + '"  : ' + ' "true"';
					} else {
						rec = rec + ', "' + ele.style.backgroundColor + '"  : ' + ' "true"';					
					}
					valcnt = valcnt + 1;
				}
			}
			
			if (len > 0){
				filter = filter + rec + ' }';
			}
			filter = filter + '}';
			
			
			
			{% if product_category.category_id %}				
				
				$.ajax({url: '{% url "curated_collections" product_category.category_id %}', 
					data: filter, 
					dataType: 'text', 
					type: 'POST',
					success: function (data) {
						//console.log(data);
						$("#img-display").html(data);
						//data = JSON.parse(data);
					},
					error: function(xhr){
						alert("An error occured: " + xhr.status + " " + xhr.statusText + " Apologies for the inconvenience!! Please let us know the details and we will be happy to help sort it out."); 
						return;
					}
				});			
			{% else %}
			
				$.ajax({url: '{% url "all_stock_images" %}', 
					data: filter, 
					dataType: 'text', 
					type: 'POST',
					success: function (data) {
						//console.log(data);
						$("#img-display").html(data);
						//data = JSON.parse(data);
					},
					error: function(xhr){
						alert("An error occured: " + xhr.status + " " + xhr.statusText + " Apologies for the inconvenience!! Please let us know the details and we will be happy to help sort it out."); 
						return;
					}
				});			
			
			{% endif %}
		}
	</script>
	
	<script>
		var isBreakpoint = function(viewport_size){
		  //return $('.device-' + viewport_size).is(':visible');
		  if (viewport_size == 'xs'){
			return window.innerWidth < 768;
		  }
		  if (viewport_size == 'sm'){
			return window.innerWidth < 991;
		  }
		  if (viewport_size == 'md'){
			return window.innerWidth < 1199;
		  }
		  if (viewport_size == 'lg'){
			return window.innerWidth > 1199;
		  }
		}	
	
		jQuery(document).ready(function(){

			  if (isBreakpoint('xs')){
				$('#cat_navigation').removeClass('show');
				$('#filter_navigation').removeClass('show');
			  }
			  else {
				$('#cat_navigation').addClass('show');
				$('#filter_navigation').addClass('show');
			  }		
		});
	</script>
	
	<script>
		function select_color(ele){
			if (ele.innerHTML == "<i class=\"fa fa-check\"></i>"){
				ele.innerHTML = "";
			} else {
				ele.innerHTML = "<i class ='fa fa-check'></i>";
			}
		}
	</script>
	{% endblock jscripts %}
			
	